{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a\\ant-design-vue-jeecg\\src\\views\\competition\\modules\\CompetitionForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\views\\competition\\modules\\CompetitionForm.vue","mtime":1661068762947},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1657458618345},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1657458571653}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAction } from '@/api/manage';\nimport { JVxeTableModelMixin } from '@/mixins/JVxeTableModelMixin.js';\nimport { JVXETypes } from '@/components/jeecg/JVxeTable';\nimport { getRefPromise, VALIDATE_FAILED } from '@/components/jeecg/JVxeTable/utils/vxeUtils.js';\nimport { validateDuplicateValue } from '@/utils/util';\nimport JFormContainer from '@/components/jeecg/JFormContainer';\nexport default {\n  name: 'CompetitionForm',\n  mixins: [JVxeTableModelMixin],\n  components: {\n    JFormContainer: JFormContainer\n  },\n  data: function data() {\n    return {\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 5\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 16\n        }\n      },\n      model: {},\n      // 新增时子表默认添加几行空数据\n      addDefaultRowNum: 1,\n      validatorRules: {},\n      refKeys: ['competitionPermission'],\n      tableKeys: ['competitionPermission'],\n      activeKey: 'competitionPermission',\n      // 大赛权限表\n      competitionPermissionTable: {\n        loading: false,\n        dataSource: [],\n        columns: [{\n          title: '用户',\n          key: 'userId',\n          type: JVXETypes.select,\n          options: [],\n          dictCode: \"sys_user,username,id\",\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '类型',\n          key: 'type',\n          type: JVXETypes.select,\n          options: [],\n          dictCode: \"\tcompetition_permissions_type\",\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }]\n      },\n      url: {\n        add: \"/competition/competition/add\",\n        edit: \"/competition/competition/edit\",\n        queryById: \"/competition/competition/queryById\",\n        competitionPermission: {\n          list: '/competition/competition/queryCompetitionPermissionByMainId'\n        }\n      }\n    };\n  },\n  props: {\n    //表单禁用\n    disabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  computed: {\n    formDisabled: function formDisabled() {\n      return this.disabled;\n    }\n  },\n  created: function created() {},\n  methods: {\n    addBefore: function addBefore() {\n      this.competitionPermissionTable.dataSource = [];\n    },\n    getAllTable: function getAllTable() {\n      var _this = this;\n\n      var values = this.tableKeys.map(function (key) {\n        return getRefPromise(_this, key);\n      });\n      return Promise.all(values);\n    },\n\n    /** 调用完edit()方法之后会自动调用此方法 */\n    editAfter: function editAfter() {\n      this.$nextTick(function () {}); // 加载子表数据\n\n      if (this.model.id) {\n        var params = {\n          id: this.model.id\n        };\n        this.requestSubTableData(this.url.competitionPermission.list, params, this.competitionPermissionTable);\n      }\n    },\n    //校验所有一对一子表表单\n    validateSubForm: function validateSubForm(allValues) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        Promise.all([]).then(function () {\n          resolve(allValues);\n        }).catch(function (e) {\n          if (e.error === VALIDATE_FAILED) {\n            // 如果有未通过表单验证的子表，就自动跳转到它所在的tab\n            _this2.activeKey = e.index == null ? _this2.activeKey : _this2.refKeys[e.index];\n          } else {\n            console.error(e);\n          }\n        });\n      });\n    },\n\n    /** 整理成formData */\n    classifyIntoFormData: function classifyIntoFormData(allValues) {\n      var main = Object.assign(this.model, allValues.formValue);\n      return _objectSpread(_objectSpread({}, main), {}, {\n        // 展开\n        competitionPermissionList: allValues.tablesValue[0].tableData\n      });\n    },\n    validateError: function validateError(msg) {\n      this.$message.error(msg);\n    }\n  }\n};",{"version":3,"sources":["CompetitionForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <a-spin :spinning=\"confirmLoading\">\r\n    <j-form-container :disabled=\"formDisabled\">\r\n      <!-- 主表单区域 -->\r\n      <a-form-model ref=\"form\" :model=\"model\" :rules=\"validatorRules\" slot=\"detail\">\r\n        <a-row>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"名称\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"name\">\r\n              <a-input v-model=\"model.name\" placeholder=\"请输入名称\" ></a-input>\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"图片\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"picture\">\r\n              <j-image-upload isMultiple  v-model=\"model.picture\" ></j-image-upload>\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"简介\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"introduction\">\r\n              <a-textarea v-model=\"model.introduction\" rows=\"4\" placeholder=\"请输入简介\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"标题\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"title\">\r\n              <a-input v-model=\"model.title\" placeholder=\"请输入标题\" ></a-input>\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"是否需要志愿者\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"needVolunteers\">\r\n              <j-dict-select-tag type=\"radio\" v-model=\"model.needVolunteers\" dictCode=\"yn\" placeholder=\"请选择是否需要志愿者\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"赛事详细介绍\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"detailIntroduce\">\r\n              <j-editor v-model=\"model.detailIntroduce\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"赛题详细\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"problem\">\r\n              <j-editor v-model=\"model.problem\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"开始时间\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"startTime\">\r\n              <j-date placeholder=\"请选择开始时间\" v-model=\"model.startTime\" :show-time=\"true\" date-format=\"YYYY-MM-DD HH:mm:ss\" style=\"width: 100%\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"结束时间\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"endTime\">\r\n              <j-date placeholder=\"请选择结束时间\" v-model=\"model.endTime\" :show-time=\"true\" date-format=\"YYYY-MM-DD HH:mm:ss\" style=\"width: 100%\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"赛事类型\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"type\">\r\n              <j-dict-select-tag type=\"list\" v-model=\"model.type\" dictCode=\"competitionType\" placeholder=\"请选择赛事类型\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n          <a-col :span=\"24\" >\r\n            <a-form-model-item label=\"奖项设置\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" prop=\"award\">\r\n              <j-editor v-model=\"model.award\" />\r\n            </a-form-model-item>\r\n          </a-col>\r\n        </a-row>\r\n      </a-form-model>\r\n    </j-form-container>\r\n      <!-- 子表单区域 -->\r\n    <a-tabs v-model=\"activeKey\" @change=\"handleChangeTabs\">\r\n      <a-tab-pane tab=\"大赛权限表\" :key=\"refKeys[0]\" :forceRender=\"true\">\r\n        <j-vxe-table\r\n          keep-source\r\n          :ref=\"refKeys[0]\"\r\n          :loading=\"competitionPermissionTable.loading\"\r\n          :columns=\"competitionPermissionTable.columns\"\r\n          :dataSource=\"competitionPermissionTable.dataSource\"\r\n          :maxHeight=\"300\"\r\n          :disabled=\"formDisabled\"\r\n          :rowNumber=\"true\"\r\n          :rowSelection=\"true\"\r\n          :toolbar=\"true\"\r\n          />\r\n      </a-tab-pane>\r\n    </a-tabs>\r\n  </a-spin>\r\n</template>\r\n\r\n<script>\r\n\r\n  import { getAction } from '@/api/manage'\r\n  import { JVxeTableModelMixin } from '@/mixins/JVxeTableModelMixin.js'\r\n  import { JVXETypes } from '@/components/jeecg/JVxeTable'\r\n  import { getRefPromise,VALIDATE_FAILED} from '@/components/jeecg/JVxeTable/utils/vxeUtils.js'\r\n  import { validateDuplicateValue } from '@/utils/util'\r\n  import JFormContainer from '@/components/jeecg/JFormContainer'\r\n\r\n  export default {\r\n    name: 'CompetitionForm',\r\n    mixins: [JVxeTableModelMixin],\r\n    components: {\r\n      JFormContainer,\r\n    },\r\n    data() {\r\n      return {\r\n        labelCol: {\r\n          xs: { span: 24 },\r\n          sm: { span: 5 },\r\n        },\r\n        wrapperCol: {\r\n          xs: { span: 24 },\r\n          sm: { span: 16 },\r\n        },\r\n        model:{\r\n         },\r\n        // 新增时子表默认添加几行空数据\r\n        addDefaultRowNum: 1,\r\n        validatorRules: {\r\n        },\r\n        refKeys: ['competitionPermission', ],\r\n        tableKeys:['competitionPermission', ],\r\n        activeKey: 'competitionPermission',\r\n        // 大赛权限表\r\n        competitionPermissionTable: {\r\n          loading: false,\r\n          dataSource: [],\r\n          columns: [\r\n            {\r\n              title: '用户',\r\n              key: 'userId',\r\n              type: JVXETypes.select,\r\n              options:[],\r\n              dictCode:\"sys_user,username,id\",\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue:'',\r\n            },\r\n            {\r\n              title: '类型',\r\n              key: 'type',\r\n              type: JVXETypes.select,\r\n              options:[],\r\n              dictCode:\"\tcompetition_permissions_type\",\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue:'',\r\n            },\r\n          ]\r\n        },\r\n        url: {\r\n          add: \"/competition/competition/add\",\r\n          edit: \"/competition/competition/edit\",\r\n          queryById: \"/competition/competition/queryById\",\r\n          competitionPermission: {\r\n            list: '/competition/competition/queryCompetitionPermissionByMainId'\r\n          },\r\n        }\r\n      }\r\n    },\r\n    props: {\r\n      //表单禁用\r\n      disabled: {\r\n        type: Boolean,\r\n        default: false,\r\n        required: false\r\n      }\r\n    },\r\n    computed: {\r\n      formDisabled(){\r\n        return this.disabled\r\n      },\r\n    },\r\n    created () {\r\n    },\r\n    methods: {\r\n      addBefore(){\r\n        this.competitionPermissionTable.dataSource=[]\r\n      },\r\n      getAllTable() {\r\n        let values = this.tableKeys.map(key => getRefPromise(this, key))\r\n        return Promise.all(values)\r\n      },\r\n      /** 调用完edit()方法之后会自动调用此方法 */\r\n      editAfter() {\r\n        this.$nextTick(() => {\r\n        })\r\n        // 加载子表数据\r\n        if (this.model.id) {\r\n          let params = { id: this.model.id }\r\n          this.requestSubTableData(this.url.competitionPermission.list, params, this.competitionPermissionTable)\r\n        }\r\n      },\r\n      //校验所有一对一子表表单\r\n        validateSubForm(allValues){\r\n            return new Promise((resolve,reject)=>{\r\n              Promise.all([\r\n              ]).then(() => {\r\n                resolve(allValues)\r\n              }).catch(e => {\r\n                if (e.error === VALIDATE_FAILED) {\r\n                  // 如果有未通过表单验证的子表，就自动跳转到它所在的tab\r\n                  this.activeKey = e.index == null ? this.activeKey : this.refKeys[e.index]\r\n                } else {\r\n                  console.error(e)\r\n                }\r\n              })\r\n            })\r\n        },\r\n      /** 整理成formData */\r\n      classifyIntoFormData(allValues) {\r\n        let main = Object.assign(this.model, allValues.formValue)\r\n        return {\r\n          ...main, // 展开\r\n          competitionPermissionList: allValues.tablesValue[0].tableData,\r\n        }\r\n      },\r\n      validateError(msg){\r\n        this.$message.error(msg)\r\n      },\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n</style>"],"sourceRoot":"src/views/competition/modules"}]}
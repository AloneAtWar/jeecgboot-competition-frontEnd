{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a\\ant-design-vue-jeecg\\src\\views\\user\\oauth2\\OAuth2Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\views\\user\\oauth2\\OAuth2Login.vue","mtime":1661074531327},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1657458618345},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1657458571653}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapActions } from 'vuex';\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util';\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types';\nexport default {\n  name: 'OAuth2Login',\n  data: function data() {\n    return {\n      env: {\n        thirdApp: false,\n        wxWork: false,\n        dingtalk: false\n      }\n    };\n  },\n  beforeCreate: function beforeCreate() {\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\n    if (!isOAuth2AppEnv()) {\n      this.$router.replace({\n        path: '/user/login'\n      });\n    }\n  },\n  created: function created() {\n    this.checkEnv();\n    this.doOAuth2Login();\n  },\n  methods: _objectSpread(_objectSpread({}, mapActions(['ThirdLogin'])), {}, {\n    /** 检测当前的环境 */\n    checkEnv: function checkEnv() {\n      // 判断当时是否是企业微信环境\n      if (/wxwork/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true;\n        this.env.wxWork = true;\n      } // 判断当时是否是钉钉环境\n\n\n      if (/dingtalk/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true;\n        this.env.dingtalk = true;\n      }\n    },\n\n    /** 进行OAuth2登录操作 */\n    doOAuth2Login: function doOAuth2Login() {\n      if (this.env.thirdApp) {\n        // 判断是否携带了Token，是就说明登录成功\n        if (this.$route.query.oauth2LoginToken) {\n          this.thirdType = this.$route.query.thirdType;\n          var token = this.$route.query.oauth2LoginToken;\n          this.doThirdLogin(token);\n        } else if (this.env.wxWork) {\n          this.doWechatEnterpriseOAuth2Login();\n        } else if (this.env.dingtalk) {\n          this.doDingTalkOAuth2Login();\n        }\n      }\n    },\n    // 根据token执行登录\n    doThirdLogin: function doThirdLogin(token) {\n      var _this = this;\n\n      var param = {};\n      param.thirdType = this.thirdType;\n      param.token = token;\n      this.ThirdLogin(param).then(function (res) {\n        if (res.success) {\n          _this.loginSuccess();\n        } else {\n          _this.requestFailed(res);\n        }\n      });\n    },\n    loginSuccess: function loginSuccess() {\n      // 登陆成功，重定向到主页\n      this.$router.replace({\n        path: INDEX_MAIN_PAGE_PATH\n      }); // TODO 这个提示是否还需要？\n\n      this.$notification.success({\n        message: '欢迎',\n        description: \"\".concat(timeFix(), \"\\uFF0C\\u6B22\\u8FCE\\u56DE\\u6765\")\n      });\n    },\n    requestFailed: function requestFailed(err) {\n      this.$error({\n        title: '登录失败',\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\n        okText: '重新登陆',\n        onOk: function onOk() {\n          window.location.reload();\n        },\n        onCancel: function onCancel() {\n          window.location.reload();\n        }\n      });\n    },\n\n    /** 企业微信OAuth2登录 */\n    doWechatEnterpriseOAuth2Login: function doWechatEnterpriseOAuth2Login() {\n      this.sysOAuth2Login('wechat_enterprise');\n    },\n\n    /** 钉钉OAuth2登录 */\n    doDingTalkOAuth2Login: function doDingTalkOAuth2Login() {\n      this.sysOAuth2Login('dingtalk');\n    },\n\n    /** 后台构造oauth2登录地址 */\n    sysOAuth2Login: function sysOAuth2Login(source) {\n      var url = \"\".concat(window._CONFIG['domianURL'], \"/sys/thirdLogin/oauth2/\").concat(source, \"/login\");\n      url += \"?state=\".concat(encodeURIComponent(window.location.origin));\n      window.location.href = url;\n    }\n  })\n};",{"version":3,"sources":["OAuth2Login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <div id=\"loader-wrapper\">\r\n      <div id=\"loader\"></div>\r\n      <div class=\"loader-section section-left\"></div>\r\n      <div class=\"loader-section section-right\"></div>\r\n      <div class=\"load_title\">正在登录 JeecgBoot 低代码平台，请耐心等待</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions } from 'vuex'\r\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util'\r\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\r\n\r\nexport default {\r\n  name: 'OAuth2Login',\r\n  data() {\r\n    return {\r\n      env: {\r\n        thirdApp: false,\r\n        wxWork: false,\r\n        dingtalk: false,\r\n      },\r\n    }\r\n  },\r\n  beforeCreate() {\r\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\r\n    if (!isOAuth2AppEnv()) {\r\n      this.$router.replace({path: '/user/login'})\r\n    }\r\n  },\r\n  created() {\r\n    this.checkEnv()\r\n    this.doOAuth2Login()\r\n  },\r\n  methods: {\r\n    ...mapActions(['ThirdLogin']),\r\n\r\n    /** 检测当前的环境 */\r\n    checkEnv() {\r\n      // 判断当时是否是企业微信环境\r\n      if (/wxwork/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.wxWork = true\r\n      }\r\n      // 判断当时是否是钉钉环境\r\n      if (/dingtalk/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.dingtalk = true\r\n      }\r\n    },\r\n\r\n    /** 进行OAuth2登录操作 */\r\n    doOAuth2Login() {\r\n      if (this.env.thirdApp) {\r\n        // 判断是否携带了Token，是就说明登录成功\r\n        if (this.$route.query.oauth2LoginToken) {\r\n          this.thirdType = this.$route.query.thirdType\r\n          let token = this.$route.query.oauth2LoginToken\r\n          this.doThirdLogin(token)\r\n        } else if (this.env.wxWork) {\r\n          this.doWechatEnterpriseOAuth2Login()\r\n        } else if (this.env.dingtalk) {\r\n          this.doDingTalkOAuth2Login()\r\n        }\r\n      }\r\n    },\r\n\r\n    // 根据token执行登录\r\n    doThirdLogin(token) {\r\n      let param = {}\r\n      param.thirdType = this.thirdType\r\n      param.token = token\r\n      this.ThirdLogin(param).then(res => {\r\n        if (res.success) {\r\n          this.loginSuccess()\r\n        } else {\r\n          this.requestFailed(res)\r\n        }\r\n      })\r\n    },\r\n    loginSuccess() {\r\n      // 登陆成功，重定向到主页\r\n      this.$router.replace({path: INDEX_MAIN_PAGE_PATH})\r\n      // TODO 这个提示是否还需要？\r\n      this.$notification.success({\r\n        message: '欢迎',\r\n        description: `${timeFix()}，欢迎回来`,\r\n      })\r\n    },\r\n    requestFailed(err) {\r\n      this.$error({\r\n        title: '登录失败',\r\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\r\n        okText: '重新登陆',\r\n        onOk() {\r\n          window.location.reload()\r\n        },\r\n        onCancel() {\r\n          window.location.reload()\r\n        },\r\n      })\r\n    },\r\n\r\n    /** 企业微信OAuth2登录 */\r\n    doWechatEnterpriseOAuth2Login() {\r\n      this.sysOAuth2Login('wechat_enterprise')\r\n    },\r\n\r\n    /** 钉钉OAuth2登录 */\r\n    doDingTalkOAuth2Login() {\r\n      this.sysOAuth2Login('dingtalk')\r\n    },\r\n\r\n    /** 后台构造oauth2登录地址 */\r\n    sysOAuth2Login(source) {\r\n      let url = `${window._CONFIG['domianURL']}/sys/thirdLogin/oauth2/${source}/login`\r\n      url += `?state=${encodeURIComponent(window.location.origin)}`\r\n      window.location.href = url\r\n    },\r\n\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"sourceRoot":"src/views/user/oauth2"}]}
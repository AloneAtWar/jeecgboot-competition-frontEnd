{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!D:\\a\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JVxeTable\\utils\\vxeUtils.js","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JVxeTable\\utils\\vxeUtils.js","mtime":1661074531199},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1657458618345},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1657458632572}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"D:/a/ant-design-vue-jeecg/node_modules/@babel/runtime/regenerator\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport { getVmParentByName } from '@/utils/util';\nimport { JVXETypes } from '@comp/jeecg/JVxeTable/index';\nexport var VALIDATE_FAILED = Symbol();\n/**\r\n * 获取指定的 $refs 对象\r\n * 有时候可能会遇到组件未挂载到页面中的情况，导致无法获取 $refs 中的某个对象\r\n * 这个方法可以等待挂载完成之后再返回 $refs 的对象，避免报错\r\n * @author sunjianlei\r\n **/\n\nexport function getRefPromise(vm, name) {\n  return new Promise(function (resolve) {\n    (function next() {\n      var ref = vm.$refs[name];\n\n      if (ref) {\n        resolve(ref);\n      } else {\n        setTimeout(function () {\n          next();\n        }, 10);\n      }\n    })();\n  });\n}\n/** 获取某一数字输入框列中的最大的值 */\n\nexport function getInputNumberMaxValue(col, rowsValues) {\n  var maxNum = 0;\n  Object.values(rowsValues).forEach(function (rowValue, index) {\n    var val = rowValue[col.key],\n        num;\n\n    try {\n      num = Number.parseFloat(val);\n    } catch (_unused) {\n      num = 0;\n    } // 把首次循环的结果当成最大值\n\n\n    if (index === 0) {\n      maxNum = num;\n    } else {\n      maxNum = num > maxNum ? num : maxNum;\n    }\n  });\n  return maxNum;\n}\n/**\r\n *\r\n * 根据 tagName 获取父级节点\r\n *\r\n * @param dom 一级dom节点\r\n * @param tagName 标签名，不区分大小写\r\n * @return {HTMLElement | NULL}\r\n */\n\nexport function getParentNodeByTagName(dom) {\n  var tagName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'body';\n\n  if (tagName === 'body') {\n    return document.body;\n  }\n\n  if (dom.parentNode) {\n    if (dom.parentNode.tagName.toLowerCase() === tagName.trim().toLowerCase()) {\n      return dom.parentNode;\n    } else {\n      return getParentNodeByTagName(dom.parentNode, tagName);\n    }\n  } else {\n    return null;\n  }\n}\n/**\r\n * vxe columns 封装成高级查询可识别的选项\r\n * @param columns\r\n * @param handler 单独处理方法\r\n */\n\nexport function vxePackageToSuperQuery(columns, handler) {\n  if (Array.isArray(columns)) {\n    // 高级查询所需要的参数\n    var fieldList = []; // 遍历列\n\n    for (var i = 0; i < columns.length; i++) {\n      var col = columns[i];\n\n      if (col.type === JVXETypes.rowCheckbox || col.type === JVXETypes.rowRadio || col.type === JVXETypes.rowExpand || col.type === JVXETypes.rowNumber) {\n        continue;\n      }\n\n      var field = {\n        type: 'string',\n        value: col.key,\n        text: col.title,\n        dictCode: col.dictCode || col.dict\n      };\n\n      if (col.type === JVXETypes.date || col.type === JVXETypes.datetime) {\n        field.type = col.type;\n        field.format = col.format;\n      }\n\n      if (col.type === JVXETypes.inputNumber) {\n        field.type = 'int';\n      }\n\n      if (Array.isArray(col.options)) {\n        field.options = col.options;\n      }\n\n      if (typeof handler === 'function') {\n        Object.assign(field, handler(col, idx));\n      }\n\n      fieldList.push(field);\n    }\n\n    return fieldList;\n  } else {\n    console.error('columns必须是一个数组');\n  }\n\n  return null;\n}\n/**\r\n * 一次性验证主表单和所有的次表单\r\n * @param form 主表单 form 对象\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab\r\n * @returns {Promise<any>}\r\n * @author sunjianlei\r\n */\n\nexport function validateFormAndTables(_x, _x2, _x3) {\n  return _validateFormAndTables.apply(this, arguments);\n}\n/**\r\n * 一次性验证主表单和所有的次表单\r\n * @param form 主表单 form 对象\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab\r\n * @returns {Promise<any>}\r\n * @author sunjianlei\r\n */\n\nfunction _validateFormAndTables() {\n  _validateFormAndTables = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(form, cases, autoJumpTab) {\n    var dataMap, values, subData;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (form && typeof form.validateFields === 'function') {\n              _context.next = 2;\n              break;\n            }\n\n            throw \"form \\u53C2\\u6570\\u9700\\u8981\\u7684\\u662F\\u4E00\\u4E2Aform\\u5BF9\\u8C61\\uFF0C\\u800C\\u4F20\\u5165\\u7684\\u5374\\u662F\".concat(_typeof(form));\n\n          case 2:\n            dataMap = {};\n            _context.next = 5;\n            return new Promise(function (resolve, reject) {\n              // 验证主表表单\n              form.validateFields(function (err, values) {\n                err ? reject({\n                  error: VALIDATE_FAILED,\n                  originError: err\n                }) : resolve(values);\n              });\n            });\n\n          case 5:\n            values = _context.sent;\n            Object.assign(dataMap, {\n              formValue: values\n            }); // 验证所有子表的表单\n\n            _context.next = 9;\n            return validateTables(cases, autoJumpTab);\n\n          case 9:\n            subData = _context.sent;\n            // 合并最终数据\n            dataMap = Object.assign(dataMap, {\n              tablesValue: subData\n            });\n            return _context.abrupt(\"return\", dataMap);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _validateFormAndTables.apply(this, arguments);\n}\n\nexport function validateFormModelAndTables(_x4, _x5, _x6, _x7) {\n  return _validateFormModelAndTables.apply(this, arguments);\n}\n/**\r\n * 验证并获取一个或多个表格的所有值\r\n *\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab 校验失败后，是否自动跳转tab选项\r\n */\n\nfunction _validateFormModelAndTables() {\n  _validateFormModelAndTables = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form, formData, cases, autoJumpTab) {\n    var dataMap, values, subData;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (form && typeof form.validate === 'function') {\n              _context2.next = 2;\n              break;\n            }\n\n            throw \"form \\u53C2\\u6570\\u9700\\u8981\\u7684\\u662F\\u4E00\\u4E2Aform\\u5BF9\\u8C61\\uFF0C\\u800C\\u4F20\\u5165\\u7684\\u5374\\u662F\".concat(_typeof(form));\n\n          case 2:\n            dataMap = {};\n            _context2.next = 5;\n            return new Promise(function (resolve, reject) {\n              // 验证主表表单\n              form.validate(function (valid, obj) {\n                valid ? resolve(formData) : reject({\n                  error: VALIDATE_FAILED,\n                  originError: valid\n                });\n              });\n            });\n\n          case 5:\n            values = _context2.sent;\n            Object.assign(dataMap, {\n              formValue: values\n            }); // 验证所有子表的表单\n\n            _context2.next = 9;\n            return validateTables(cases, autoJumpTab);\n\n          case 9:\n            subData = _context2.sent;\n            // 合并最终数据\n            dataMap = Object.assign(dataMap, {\n              tablesValue: subData\n            });\n            return _context2.abrupt(\"return\", dataMap);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _validateFormModelAndTables.apply(this, arguments);\n}\n\nexport function validateTables(cases) {\n  var autoJumpTab = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  if (!Array.isArray(cases)) {\n    throw \"'validateTables'\\u51FD\\u6570\\u7684'cases'\\u53C2\\u6570\\u9700\\u8981\\u7684\\u662F\\u4E00\\u4E2A\\u6570\\u7EC4\\uFF0C\\u800C\\u4F20\\u5165\\u7684\\u5374\\u662F\".concat(_typeof(cases));\n  }\n\n  return new Promise(function (resolve, reject) {\n    var tablesData = [];\n    var index = 0;\n\n    if (!cases || cases.length === 0) {\n      resolve();\n    }\n\n    (function next() {\n      var vm = cases[index];\n      vm.validateTable().then(function (errMap) {\n        // 校验通过\n        if (!errMap) {\n          tablesData[index] = vm.getAll(); // 判断校验是否全部完成，完成返回成功，否则继续进行下一步校验\n\n          if (++index === cases.length) {\n            resolve(tablesData);\n          } else next();\n        } else {\n          // 尝试获取tabKey，如果在ATab组件内即可获取\n          var paneKey;\n          var tabPane = getVmParentByName(vm, 'ATabPane');\n\n          if (tabPane) {\n            paneKey = tabPane.$vnode.key; // 自动跳转到该表格\n\n            if (autoJumpTab) {\n              var tabs = getVmParentByName(tabPane, 'Tabs');\n              tabs && tabs.setActiveKey && tabs.setActiveKey(paneKey);\n            }\n          } // 出现未验证通过的表单，不再进行下一步校验，直接返回失败\n\n\n          reject({\n            error: VALIDATE_FAILED,\n            index: index,\n            paneKey: paneKey,\n            errMap: errMap\n          });\n        }\n      });\n    })();\n  });\n}",{"version":3,"sources":["D:/a/ant-design-vue-jeecg/src/components/jeecg/JVxeTable/utils/vxeUtils.js"],"names":["getVmParentByName","JVXETypes","VALIDATE_FAILED","Symbol","getRefPromise","vm","name","Promise","resolve","next","ref","$refs","setTimeout","getInputNumberMaxValue","col","rowsValues","maxNum","Object","values","forEach","rowValue","index","val","key","num","Number","parseFloat","getParentNodeByTagName","dom","tagName","document","body","parentNode","toLowerCase","trim","vxePackageToSuperQuery","columns","handler","Array","isArray","fieldList","i","length","type","rowCheckbox","rowRadio","rowExpand","rowNumber","field","value","text","title","dictCode","dict","date","datetime","format","inputNumber","options","assign","idx","push","console","error","validateFormAndTables","form","cases","autoJumpTab","validateFields","dataMap","reject","err","originError","formValue","validateTables","subData","tablesValue","validateFormModelAndTables","formData","validate","valid","obj","tablesData","validateTable","then","errMap","getAll","paneKey","tabPane","$vnode","tabs","setActiveKey"],"mappings":"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","sourcesContent":["import { getVmParentByName } from '@/utils/util'\r\nimport { JVXETypes } from '@comp/jeecg/JVxeTable/index'\r\n\r\nexport const VALIDATE_FAILED = Symbol()\r\n\r\n/**\r\n * 获取指定的 $refs 对象\r\n * 有时候可能会遇到组件未挂载到页面中的情况，导致无法获取 $refs 中的某个对象\r\n * 这个方法可以等待挂载完成之后再返回 $refs 的对象，避免报错\r\n * @author sunjianlei\r\n **/\r\nexport function getRefPromise(vm, name) {\r\n  return new Promise((resolve) => {\r\n    (function next() {\r\n      let ref = vm.$refs[name]\r\n      if (ref) {\r\n        resolve(ref)\r\n      } else {\r\n        setTimeout(() => {\r\n          next()\r\n        }, 10)\r\n      }\r\n    })()\r\n  })\r\n}\r\n\r\n/** 获取某一数字输入框列中的最大的值 */\r\nexport function getInputNumberMaxValue(col, rowsValues) {\r\n  let maxNum = 0\r\n  Object.values(rowsValues).forEach((rowValue, index) => {\r\n    let val = rowValue[col.key], num\r\n    try {\r\n      num = Number.parseFloat(val)\r\n    } catch {\r\n      num = 0\r\n    }\r\n    // 把首次循环的结果当成最大值\r\n    if (index === 0) {\r\n      maxNum = num\r\n    } else {\r\n      maxNum = (num > maxNum) ? num : maxNum\r\n    }\r\n  })\r\n  return maxNum\r\n}\r\n\r\n/**\r\n *\r\n * 根据 tagName 获取父级节点\r\n *\r\n * @param dom 一级dom节点\r\n * @param tagName 标签名，不区分大小写\r\n * @return {HTMLElement | NULL}\r\n */\r\nexport function getParentNodeByTagName(dom, tagName = 'body') {\r\n  if (tagName === 'body') {\r\n    return document.body\r\n  }\r\n  if (dom.parentNode) {\r\n    if (dom.parentNode.tagName.toLowerCase() === tagName.trim().toLowerCase()) {\r\n      return dom.parentNode\r\n    } else {\r\n      return getParentNodeByTagName(dom.parentNode, tagName)\r\n    }\r\n  } else {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * vxe columns 封装成高级查询可识别的选项\r\n * @param columns\r\n * @param handler 单独处理方法\r\n */\r\nexport function vxePackageToSuperQuery(columns, handler) {\r\n  if (Array.isArray(columns)) {\r\n    // 高级查询所需要的参数\r\n    let fieldList = []\r\n    // 遍历列\r\n    for (let i = 0; i < columns.length; i++) {\r\n      let col = columns[i]\r\n      if (col.type === JVXETypes.rowCheckbox ||\r\n        col.type === JVXETypes.rowRadio ||\r\n        col.type === JVXETypes.rowExpand ||\r\n        col.type === JVXETypes.rowNumber\r\n      ) {\r\n        continue\r\n      }\r\n      let field = {\r\n        type: 'string',\r\n        value: col.key,\r\n        text: col.title,\r\n        dictCode: col.dictCode || col.dict,\r\n      }\r\n      if (col.type === JVXETypes.date || col.type === JVXETypes.datetime) {\r\n        field.type = col.type\r\n        field.format = col.format\r\n      }\r\n      if (col.type === JVXETypes.inputNumber) {\r\n        field.type = 'int'\r\n      }\r\n      if (Array.isArray(col.options)) {\r\n        field.options = col.options\r\n      }\r\n      if (typeof handler === 'function') {\r\n        Object.assign(field, handler(col, idx))\r\n      }\r\n      fieldList.push(field)\r\n    }\r\n    return fieldList\r\n  } else {\r\n    console.error('columns必须是一个数组')\r\n  }\r\n  return null\r\n}\r\n\r\n/**\r\n * 一次性验证主表单和所有的次表单\r\n * @param form 主表单 form 对象\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab\r\n * @returns {Promise<any>}\r\n * @author sunjianlei\r\n */\r\nexport async function validateFormAndTables(form, cases, autoJumpTab) {\r\n  if (!(form && typeof form.validateFields === 'function')) {\r\n    throw `form 参数需要的是一个form对象，而传入的却是${typeof form}`\r\n  }\r\n  let dataMap = {}\r\n  let values = await new Promise((resolve, reject) => {\r\n    // 验证主表表单\r\n    form.validateFields((err, values) => {\r\n      err ? reject({error: VALIDATE_FAILED, originError: err}) : resolve(values)\r\n    })\r\n  })\r\n  Object.assign(dataMap, {formValue: values})\r\n  // 验证所有子表的表单\r\n  let subData = await validateTables(cases, autoJumpTab)\r\n  // 合并最终数据\r\n  dataMap = Object.assign(dataMap, {tablesValue: subData})\r\n  return dataMap\r\n}\r\n\r\n/**\r\n * 一次性验证主表单和所有的次表单\r\n * @param form 主表单 form 对象\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab\r\n * @returns {Promise<any>}\r\n * @author sunjianlei\r\n */\r\nexport async function validateFormModelAndTables(form,formData, cases, autoJumpTab) {\r\n  if (!(form && typeof form.validate === 'function')) {\r\n    throw `form 参数需要的是一个form对象，而传入的却是${typeof form}`\r\n  }\r\n  let dataMap = {}\r\n  let values = await new Promise((resolve, reject) => {\r\n    // 验证主表表单\r\n    form.validate((valid,obj) => {\r\n      valid ?resolve(formData): reject({error: VALIDATE_FAILED, originError: valid})\r\n    })\r\n  })\r\n  Object.assign(dataMap, {formValue: values})\r\n  // 验证所有子表的表单\r\n  let subData = await validateTables(cases, autoJumpTab)\r\n  // 合并最终数据\r\n  dataMap = Object.assign(dataMap, {tablesValue: subData})\r\n  return dataMap\r\n}\r\n\r\n/**\r\n * 验证并获取一个或多个表格的所有值\r\n *\r\n * @param cases 接收一个数组，每项都是一个JVxeTable实例\r\n * @param autoJumpTab 校验失败后，是否自动跳转tab选项\r\n */\r\nexport function validateTables(cases, autoJumpTab = true) {\r\n  if (!Array.isArray(cases)) {\r\n    throw `'validateTables'函数的'cases'参数需要的是一个数组，而传入的却是${typeof cases}`\r\n  }\r\n  return new Promise((resolve, reject) => {\r\n    let tablesData = []\r\n    let index = 0\r\n    if (!cases || cases.length === 0) {\r\n      resolve()\r\n    }\r\n    (function next() {\r\n      let vm = cases[index]\r\n      vm.validateTable().then(errMap => {\r\n        // 校验通过\r\n        if (!errMap) {\r\n          tablesData[index] = vm.getAll()\r\n          // 判断校验是否全部完成，完成返回成功，否则继续进行下一步校验\r\n          if (++index === cases.length) {\r\n            resolve(tablesData)\r\n          } else (\r\n            next()\r\n          )\r\n        } else {\r\n          // 尝试获取tabKey，如果在ATab组件内即可获取\r\n          let paneKey\r\n          let tabPane = getVmParentByName(vm, 'ATabPane')\r\n          if (tabPane) {\r\n            paneKey = tabPane.$vnode.key\r\n            // 自动跳转到该表格\r\n            if (autoJumpTab) {\r\n              let tabs = getVmParentByName(tabPane, 'Tabs')\r\n              tabs && tabs.setActiveKey && tabs.setActiveKey(paneKey)\r\n            }\r\n          }\r\n          // 出现未验证通过的表单，不再进行下一步校验，直接返回失败\r\n          reject({error: VALIDATE_FAILED, index, paneKey, errMap})\r\n        }\r\n      })\r\n    })()\r\n  })\r\n}"]}]}
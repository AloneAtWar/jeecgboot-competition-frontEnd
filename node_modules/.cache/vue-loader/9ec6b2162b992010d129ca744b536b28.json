{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a\\ant-design-vue-jeecg\\src\\views\\user\\oauth2\\OAuth2Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\views\\user\\oauth2\\OAuth2Login.vue","mtime":1661074531327},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1657458618345},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1657458571653}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapActions } from 'vuex'\r\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util'\r\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\r\n\r\nexport default {\r\n  name: 'OAuth2Login',\r\n  data() {\r\n    return {\r\n      env: {\r\n        thirdApp: false,\r\n        wxWork: false,\r\n        dingtalk: false,\r\n      },\r\n    }\r\n  },\r\n  beforeCreate() {\r\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\r\n    if (!isOAuth2AppEnv()) {\r\n      this.$router.replace({path: '/user/login'})\r\n    }\r\n  },\r\n  created() {\r\n    this.checkEnv()\r\n    this.doOAuth2Login()\r\n  },\r\n  methods: {\r\n    ...mapActions(['ThirdLogin']),\r\n\r\n    /** 检测当前的环境 */\r\n    checkEnv() {\r\n      // 判断当时是否是企业微信环境\r\n      if (/wxwork/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.wxWork = true\r\n      }\r\n      // 判断当时是否是钉钉环境\r\n      if (/dingtalk/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.dingtalk = true\r\n      }\r\n    },\r\n\r\n    /** 进行OAuth2登录操作 */\r\n    doOAuth2Login() {\r\n      if (this.env.thirdApp) {\r\n        // 判断是否携带了Token，是就说明登录成功\r\n        if (this.$route.query.oauth2LoginToken) {\r\n          this.thirdType = this.$route.query.thirdType\r\n          let token = this.$route.query.oauth2LoginToken\r\n          this.doThirdLogin(token)\r\n        } else if (this.env.wxWork) {\r\n          this.doWechatEnterpriseOAuth2Login()\r\n        } else if (this.env.dingtalk) {\r\n          this.doDingTalkOAuth2Login()\r\n        }\r\n      }\r\n    },\r\n\r\n    // 根据token执行登录\r\n    doThirdLogin(token) {\r\n      let param = {}\r\n      param.thirdType = this.thirdType\r\n      param.token = token\r\n      this.ThirdLogin(param).then(res => {\r\n        if (res.success) {\r\n          this.loginSuccess()\r\n        } else {\r\n          this.requestFailed(res)\r\n        }\r\n      })\r\n    },\r\n    loginSuccess() {\r\n      // 登陆成功，重定向到主页\r\n      this.$router.replace({path: INDEX_MAIN_PAGE_PATH})\r\n      // TODO 这个提示是否还需要？\r\n      this.$notification.success({\r\n        message: '欢迎',\r\n        description: `${timeFix()}，欢迎回来`,\r\n      })\r\n    },\r\n    requestFailed(err) {\r\n      this.$error({\r\n        title: '登录失败',\r\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\r\n        okText: '重新登陆',\r\n        onOk() {\r\n          window.location.reload()\r\n        },\r\n        onCancel() {\r\n          window.location.reload()\r\n        },\r\n      })\r\n    },\r\n\r\n    /** 企业微信OAuth2登录 */\r\n    doWechatEnterpriseOAuth2Login() {\r\n      this.sysOAuth2Login('wechat_enterprise')\r\n    },\r\n\r\n    /** 钉钉OAuth2登录 */\r\n    doDingTalkOAuth2Login() {\r\n      this.sysOAuth2Login('dingtalk')\r\n    },\r\n\r\n    /** 后台构造oauth2登录地址 */\r\n    sysOAuth2Login(source) {\r\n      let url = `${window._CONFIG['domianURL']}/sys/thirdLogin/oauth2/${source}/login`\r\n      url += `?state=${encodeURIComponent(window.location.origin)}`\r\n      window.location.href = url\r\n    },\r\n\r\n  },\r\n}\r\n",{"version":3,"sources":["OAuth2Login.vue"],"names":[],"mappings":";;;;;;;;;;;;AAYA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"OAuth2Login.vue","sourceRoot":"src/views/user/oauth2","sourcesContent":["<template>\r\n  <div>\r\n    <div id=\"loader-wrapper\">\r\n      <div id=\"loader\"></div>\r\n      <div class=\"loader-section section-left\"></div>\r\n      <div class=\"loader-section section-right\"></div>\r\n      <div class=\"load_title\">正在登录 JeecgBoot 低代码平台，请耐心等待</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions } from 'vuex'\r\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util'\r\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\r\n\r\nexport default {\r\n  name: 'OAuth2Login',\r\n  data() {\r\n    return {\r\n      env: {\r\n        thirdApp: false,\r\n        wxWork: false,\r\n        dingtalk: false,\r\n      },\r\n    }\r\n  },\r\n  beforeCreate() {\r\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\r\n    if (!isOAuth2AppEnv()) {\r\n      this.$router.replace({path: '/user/login'})\r\n    }\r\n  },\r\n  created() {\r\n    this.checkEnv()\r\n    this.doOAuth2Login()\r\n  },\r\n  methods: {\r\n    ...mapActions(['ThirdLogin']),\r\n\r\n    /** 检测当前的环境 */\r\n    checkEnv() {\r\n      // 判断当时是否是企业微信环境\r\n      if (/wxwork/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.wxWork = true\r\n      }\r\n      // 判断当时是否是钉钉环境\r\n      if (/dingtalk/i.test(navigator.userAgent)) {\r\n        this.env.thirdApp = true\r\n        this.env.dingtalk = true\r\n      }\r\n    },\r\n\r\n    /** 进行OAuth2登录操作 */\r\n    doOAuth2Login() {\r\n      if (this.env.thirdApp) {\r\n        // 判断是否携带了Token，是就说明登录成功\r\n        if (this.$route.query.oauth2LoginToken) {\r\n          this.thirdType = this.$route.query.thirdType\r\n          let token = this.$route.query.oauth2LoginToken\r\n          this.doThirdLogin(token)\r\n        } else if (this.env.wxWork) {\r\n          this.doWechatEnterpriseOAuth2Login()\r\n        } else if (this.env.dingtalk) {\r\n          this.doDingTalkOAuth2Login()\r\n        }\r\n      }\r\n    },\r\n\r\n    // 根据token执行登录\r\n    doThirdLogin(token) {\r\n      let param = {}\r\n      param.thirdType = this.thirdType\r\n      param.token = token\r\n      this.ThirdLogin(param).then(res => {\r\n        if (res.success) {\r\n          this.loginSuccess()\r\n        } else {\r\n          this.requestFailed(res)\r\n        }\r\n      })\r\n    },\r\n    loginSuccess() {\r\n      // 登陆成功，重定向到主页\r\n      this.$router.replace({path: INDEX_MAIN_PAGE_PATH})\r\n      // TODO 这个提示是否还需要？\r\n      this.$notification.success({\r\n        message: '欢迎',\r\n        description: `${timeFix()}，欢迎回来`,\r\n      })\r\n    },\r\n    requestFailed(err) {\r\n      this.$error({\r\n        title: '登录失败',\r\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\r\n        okText: '重新登陆',\r\n        onOk() {\r\n          window.location.reload()\r\n        },\r\n        onCancel() {\r\n          window.location.reload()\r\n        },\r\n      })\r\n    },\r\n\r\n    /** 企业微信OAuth2登录 */\r\n    doWechatEnterpriseOAuth2Login() {\r\n      this.sysOAuth2Login('wechat_enterprise')\r\n    },\r\n\r\n    /** 钉钉OAuth2登录 */\r\n    doDingTalkOAuth2Login() {\r\n      this.sysOAuth2Login('dingtalk')\r\n    },\r\n\r\n    /** 后台构造oauth2登录地址 */\r\n    sysOAuth2Login(source) {\r\n      let url = `${window._CONFIG['domianURL']}/sys/thirdLogin/oauth2/${source}/login`\r\n      url += `?state=${encodeURIComponent(window.location.origin)}`\r\n      window.location.href = url\r\n    },\r\n\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]}]}
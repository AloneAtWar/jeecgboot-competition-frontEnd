{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JMarkdownEditor\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JMarkdownEditor\\index.vue","mtime":1661074531179},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1657458618345},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1657458571653}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport 'codemirror/lib/codemirror.css'\r\nimport '@toast-ui/editor/dist/toastui-editor.css';\r\nimport '@toast-ui/editor/dist/i18n/zh-cn';\r\n\r\nimport Editor from '@toast-ui/editor';\r\nimport defaultOptions from './default-options'\r\nimport JUpload from '@/components/jeecg/JUpload'\r\nimport { getFileAccessHttpUrl } from '@/api/manage'\r\n\r\nexport default {\r\n  name: 'JMarkdownEditor',\r\n  components: {\r\n    JUpload,\r\n  },\r\n  props: {\r\n    value: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    id: {\r\n      type: String,\r\n      required: false,\r\n      default() {\r\n        return 'markdown-editor-' + +new Date() + ((Math.random() * 1000).toFixed(0) + '')\r\n      }\r\n    },\r\n    options: {\r\n      type: Object,\r\n      default() {\r\n        return defaultOptions\r\n      }\r\n    },\r\n    mode: {\r\n      type: String,\r\n      default: 'markdown'\r\n    },\r\n    height: {\r\n      type: String,\r\n      required: false,\r\n      default: '300px'\r\n    },\r\n    language: {\r\n      type: String,\r\n      required: false,\r\n      default: 'zh-CN'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      editor: null,\r\n      isShow:false,\r\n      activeIndex:\"1\",\r\n      dialogVisible:false,\r\n      index:\"1\",\r\n      fileList:[],\r\n      remark:\"\",\r\n      imageName:\"\",\r\n      imageUrl:\"\",\r\n      networkPic:\"\"\r\n    }\r\n  },\r\n  computed: {\r\n    editorOptions() {\r\n      const options = Object.assign({}, defaultOptions, this.options)\r\n      options.initialEditType = this.mode\r\n      options.height = this.height\r\n      options.language = this.language\r\n      return options\r\n    }\r\n  },\r\n  watch: {\r\n    value(newValue, preValue) {\r\n      if (newValue !== preValue && newValue !== this.editor.getMarkdown()) {\r\n        this.editor.setMarkdown(newValue)\r\n      }\r\n    },\r\n    language(val) {\r\n      this.destroyEditor()\r\n      this.initEditor()\r\n    },\r\n    height(newValue) {\r\n      this.editor.height(newValue)\r\n    },\r\n    mode(newValue) {\r\n      this.editor.changeMode(newValue)\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initEditor()\r\n  },\r\n  destroyed() {\r\n    this.destroyEditor()\r\n  },\r\n  methods: {\r\n    initEditor() {\r\n      this.editor = new Editor({\r\n        el: document.getElementById(this.id),\r\n        ...this.editorOptions\r\n      })\r\n      if (this.value) {\r\n        this.editor.setMarkdown(this.value)\r\n      }\r\n      this.editor.on('change', () => {\r\n        this.$emit('change', this.editor.getMarkdown())\r\n      })\r\n      //--begin 添加自定义上传按钮\r\n      /*\r\n       * 添加自定义按钮\r\n       */\r\n      //获取编辑器上的功能条\r\n      let toolbar = this.editor.getUI().getToolbar();\r\n      let fileDom = this.$refs.files;\r\n      //添加图片点击事件\r\n      this.editor.eventManager.addEventType('isShowClickEvent');\r\n      this.editor.eventManager.listen('isShowClickEvent', () => {\r\n        this.isShow = true\r\n        this.dialogVisible = true\r\n      });\r\n      //addImageBlobHook图片上传、剪切、拖拽都会走此方法\r\n      // 删除默认监听事件\r\n      this.editor.eventManager.removeEventHandler('addImageBlobHook')\r\n      // 添加自定义监听事件\r\n      this.editor.eventManager.listen('addImageBlobHook', (blob, callback) => {\r\n        this.upload(blob, url => {\r\n          callback(url)\r\n        })\r\n      })\r\n      // 添加自定义按钮 第二个参数代表位置，不传默认放在最后\r\n      toolbar.insertItem(15,{\r\n        type: 'button',\r\n        options:{\r\n          name: 'customize',\r\n          className: 'tui-image tui-toolbar-icons',\r\n          event: 'isShowClickEvent',\r\n          tooltip: '上传图片',\r\n        }\r\n        //\r\n      });\r\n      //--end 添加自定义上传按钮\r\n    },\r\n    destroyEditor() {\r\n      if (!this.editor) return\r\n      this.editor.off('change')\r\n      this.editor.remove()\r\n    },\r\n    setMarkdown(value) {\r\n      this.editor.setMarkdown(value)\r\n    },\r\n    getMarkdown() {\r\n      return this.editor.getMarkdown()\r\n    },\r\n    setHtml(value) {\r\n      this.editor.setHtml(value)\r\n    },\r\n    getHtml() {\r\n      return this.editor.getHtml()\r\n    },\r\n    handleOk(){\r\n      if(this.index=='1'){\r\n        this.imageUrl = getFileAccessHttpUrl(this.fileList)\r\n        if(this.remark){\r\n          this.addImgToMd(this.imageUrl,this.remark)\r\n        }else{\r\n          this.addImgToMd(this.imageUrl,\"\")\r\n        }\r\n      }else{\r\n        if(this.remark){\r\n          this.addImgToMd(this.networkPic,this.remark)\r\n        }else{\r\n          this.addImgToMd(this.networkPic,\"\")\r\n        }\r\n      }\r\n      this.index=\"1\"\r\n      this.fileList=[]\r\n      this.imageName=\"\";\r\n      this.imageUrl=\"\";\r\n      this.remark=\"\"\r\n      this.networkPic=\"\"\r\n      this.dialogVisible=false\r\n      this.isShow=false;\r\n    },\r\n    handleClose(done) {\r\n      done();\r\n    },\r\n    handleChange(val){\r\n      this.fileList=[]\r\n      this.remark=\"\"\r\n      this.imageName=\"\"\r\n      this.imageUrl=\"\"\r\n      this.networkPic=\"\"\r\n      this.index=val\r\n    },\r\n    //添加图片到markdown\r\n    addImgToMd(data,name) {\r\n      let editor = this.editor.getCodeMirror();\r\n      let editorHtml = this.editor.getCurrentModeEditor();\r\n      let isMarkdownMode = this.editor.isMarkdownMode();\r\n      if (isMarkdownMode) {\r\n        editor.replaceSelection(`![${name}](${data})`);\r\n      } else {\r\n        let range = editorHtml.getRange();\r\n        let img = document.createElement('img');\r\n        img.src = `${data}`;\r\n        img.alt = name;\r\n        range.insertNode(img);\r\n      }\r\n    },\r\n  },\r\n  model: {\r\n    prop: 'value',\r\n    event: 'change'\r\n  }\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/jeecg/JMarkdownEditor","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"j-markdown-editor\" :id=\"id\"/>\r\n    <div v-if=\"isShow\">\r\n      <j-modal\r\n        title=\"图片上传\"\r\n        :visible.sync=\"dialogVisible\"\r\n        width=\"30%\"\r\n        :before-close=\"handleClose\"\r\n        @ok=\"handleOk\">\r\n        <a-tabs default-active-key=\"1\" @change=\"handleChange\">\r\n          <a-tab-pane tab=\"本地图片上传\" key=\"1\" :forceRender=\"true\">\r\n            <j-upload v-model=\"fileList\" :number=\"1\"></j-upload>\r\n            <div style=\"margin-top: 20px\">\r\n              <a-input v-model=\"remark\" placeholder=\"请填写备注\"></a-input>\r\n            </div>\r\n          </a-tab-pane>\r\n          <a-tab-pane tab=\"网络图片地址\" key=\"2\" :forceRender=\"true\">\r\n            <a-input v-model=\"networkPic\" placeholder=\"请填写网络图片地址\"></a-input>\r\n            <a-input style=\"margin-top: 20px\" v-model=\"remark\" placeholder=\"请填写备注\"></a-input>\r\n          </a-tab-pane>\r\n        </a-tabs>\r\n      </j-modal>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport 'codemirror/lib/codemirror.css'\r\nimport '@toast-ui/editor/dist/toastui-editor.css';\r\nimport '@toast-ui/editor/dist/i18n/zh-cn';\r\n\r\nimport Editor from '@toast-ui/editor';\r\nimport defaultOptions from './default-options'\r\nimport JUpload from '@/components/jeecg/JUpload'\r\nimport { getFileAccessHttpUrl } from '@/api/manage'\r\n\r\nexport default {\r\n  name: 'JMarkdownEditor',\r\n  components: {\r\n    JUpload,\r\n  },\r\n  props: {\r\n    value: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    id: {\r\n      type: String,\r\n      required: false,\r\n      default() {\r\n        return 'markdown-editor-' + +new Date() + ((Math.random() * 1000).toFixed(0) + '')\r\n      }\r\n    },\r\n    options: {\r\n      type: Object,\r\n      default() {\r\n        return defaultOptions\r\n      }\r\n    },\r\n    mode: {\r\n      type: String,\r\n      default: 'markdown'\r\n    },\r\n    height: {\r\n      type: String,\r\n      required: false,\r\n      default: '300px'\r\n    },\r\n    language: {\r\n      type: String,\r\n      required: false,\r\n      default: 'zh-CN'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      editor: null,\r\n      isShow:false,\r\n      activeIndex:\"1\",\r\n      dialogVisible:false,\r\n      index:\"1\",\r\n      fileList:[],\r\n      remark:\"\",\r\n      imageName:\"\",\r\n      imageUrl:\"\",\r\n      networkPic:\"\"\r\n    }\r\n  },\r\n  computed: {\r\n    editorOptions() {\r\n      const options = Object.assign({}, defaultOptions, this.options)\r\n      options.initialEditType = this.mode\r\n      options.height = this.height\r\n      options.language = this.language\r\n      return options\r\n    }\r\n  },\r\n  watch: {\r\n    value(newValue, preValue) {\r\n      if (newValue !== preValue && newValue !== this.editor.getMarkdown()) {\r\n        this.editor.setMarkdown(newValue)\r\n      }\r\n    },\r\n    language(val) {\r\n      this.destroyEditor()\r\n      this.initEditor()\r\n    },\r\n    height(newValue) {\r\n      this.editor.height(newValue)\r\n    },\r\n    mode(newValue) {\r\n      this.editor.changeMode(newValue)\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initEditor()\r\n  },\r\n  destroyed() {\r\n    this.destroyEditor()\r\n  },\r\n  methods: {\r\n    initEditor() {\r\n      this.editor = new Editor({\r\n        el: document.getElementById(this.id),\r\n        ...this.editorOptions\r\n      })\r\n      if (this.value) {\r\n        this.editor.setMarkdown(this.value)\r\n      }\r\n      this.editor.on('change', () => {\r\n        this.$emit('change', this.editor.getMarkdown())\r\n      })\r\n      //--begin 添加自定义上传按钮\r\n      /*\r\n       * 添加自定义按钮\r\n       */\r\n      //获取编辑器上的功能条\r\n      let toolbar = this.editor.getUI().getToolbar();\r\n      let fileDom = this.$refs.files;\r\n      //添加图片点击事件\r\n      this.editor.eventManager.addEventType('isShowClickEvent');\r\n      this.editor.eventManager.listen('isShowClickEvent', () => {\r\n        this.isShow = true\r\n        this.dialogVisible = true\r\n      });\r\n      //addImageBlobHook图片上传、剪切、拖拽都会走此方法\r\n      // 删除默认监听事件\r\n      this.editor.eventManager.removeEventHandler('addImageBlobHook')\r\n      // 添加自定义监听事件\r\n      this.editor.eventManager.listen('addImageBlobHook', (blob, callback) => {\r\n        this.upload(blob, url => {\r\n          callback(url)\r\n        })\r\n      })\r\n      // 添加自定义按钮 第二个参数代表位置，不传默认放在最后\r\n      toolbar.insertItem(15,{\r\n        type: 'button',\r\n        options:{\r\n          name: 'customize',\r\n          className: 'tui-image tui-toolbar-icons',\r\n          event: 'isShowClickEvent',\r\n          tooltip: '上传图片',\r\n        }\r\n        //\r\n      });\r\n      //--end 添加自定义上传按钮\r\n    },\r\n    destroyEditor() {\r\n      if (!this.editor) return\r\n      this.editor.off('change')\r\n      this.editor.remove()\r\n    },\r\n    setMarkdown(value) {\r\n      this.editor.setMarkdown(value)\r\n    },\r\n    getMarkdown() {\r\n      return this.editor.getMarkdown()\r\n    },\r\n    setHtml(value) {\r\n      this.editor.setHtml(value)\r\n    },\r\n    getHtml() {\r\n      return this.editor.getHtml()\r\n    },\r\n    handleOk(){\r\n      if(this.index=='1'){\r\n        this.imageUrl = getFileAccessHttpUrl(this.fileList)\r\n        if(this.remark){\r\n          this.addImgToMd(this.imageUrl,this.remark)\r\n        }else{\r\n          this.addImgToMd(this.imageUrl,\"\")\r\n        }\r\n      }else{\r\n        if(this.remark){\r\n          this.addImgToMd(this.networkPic,this.remark)\r\n        }else{\r\n          this.addImgToMd(this.networkPic,\"\")\r\n        }\r\n      }\r\n      this.index=\"1\"\r\n      this.fileList=[]\r\n      this.imageName=\"\";\r\n      this.imageUrl=\"\";\r\n      this.remark=\"\"\r\n      this.networkPic=\"\"\r\n      this.dialogVisible=false\r\n      this.isShow=false;\r\n    },\r\n    handleClose(done) {\r\n      done();\r\n    },\r\n    handleChange(val){\r\n      this.fileList=[]\r\n      this.remark=\"\"\r\n      this.imageName=\"\"\r\n      this.imageUrl=\"\"\r\n      this.networkPic=\"\"\r\n      this.index=val\r\n    },\r\n    //添加图片到markdown\r\n    addImgToMd(data,name) {\r\n      let editor = this.editor.getCodeMirror();\r\n      let editorHtml = this.editor.getCurrentModeEditor();\r\n      let isMarkdownMode = this.editor.isMarkdownMode();\r\n      if (isMarkdownMode) {\r\n        editor.replaceSelection(`![${name}](${data})`);\r\n      } else {\r\n        let range = editorHtml.getRange();\r\n        let img = document.createElement('img');\r\n        img.src = `${data}`;\r\n        img.alt = name;\r\n        range.insertNode(img);\r\n      }\r\n    },\r\n  },\r\n  model: {\r\n    prop: 'value',\r\n    event: 'change'\r\n  }\r\n}\r\n</script>\r\n<style scoped lang=\"less\">\r\n\r\n  .j-markdown-editor {\r\n    /deep/ .tui-editor-defaultUI {\r\n      .te-mode-switch,\r\n      .tui-scrollsync\r\n      {\r\n        line-height: 1.5;\r\n      }\r\n    }\r\n  }\r\n\r\n</style>"]}]}
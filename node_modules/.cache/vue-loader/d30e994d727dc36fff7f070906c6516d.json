{"remainingRequest":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JImageUpload.vue?vue&type=style&index=0&id=365d6523&scoped=true&lang=css&","dependencies":[{"path":"D:\\a\\ant-design-vue-jeecg\\src\\components\\jeecg\\JImageUpload.vue","mtime":1661074531177},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\css-loader\\index.js","mtime":1657458574837},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1657458571653},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\postcss-loader\\src\\index.js","mtime":1657458638287},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657458637011},{"path":"D:\\a\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1657458571653}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* update--begin--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白\n* https://github.com/zhangdaiscott/jeecg-boot/issues/1810\n* https://github.com/zhangdaiscott/jeecg-boot/issues/1779\n*/\n\n/deep/ .imgupload .iconp{padding:20px;}\n/* update--end--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白*/\n\n/deep/ .image-upload-single-over .ant-upload-select{display: none}\n",{"version":3,"sources":["JImageUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqOA;AACA;AACA;AACA;;AAEA;AACA;;AAEA","file":"JImageUpload.vue","sourceRoot":"src/components/jeecg","sourcesContent":["<template>\r\n  <div class=\"img\">\r\n    <a-upload\r\n      name=\"file\"\r\n      listType=\"picture-card\"\r\n      :multiple=\"isMultiple\"\r\n      :action=\"uploadAction\"\r\n      :headers=\"headers\"\r\n      :data=\"{biz:bizPath}\"\r\n      :fileList=\"fileList\"\r\n      :beforeUpload=\"beforeUpload\"\r\n      :disabled=\"disabled\"\r\n      :isMultiple=\"isMultiple\"\r\n\r\n      @change=\"handleChange\"\r\n      @preview=\"handlePreview\"\r\n      :class=\"[!isMultiple?'imgupload':'', (!isMultiple && picUrl)?'image-upload-single-over':'' ]\">\r\n      <div>\r\n        <!--<img v-if=\"!isMultiple && picUrl\" :src=\"getAvatarView()\" style=\"width:100%;height:100%\"/>-->\r\n        <div class=\"iconp\">\r\n          <a-icon :type=\"uploadLoading ? 'loading' : 'plus'\" />\r\n          <div class=\"ant-upload-text\">{{ text }}</div>\r\n        </div>\r\n      </div>\r\n      <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"handleCancel()\">\r\n        <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\"/>\r\n      </a-modal>\r\n    </a-upload>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import Vue from 'vue'\r\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\"\r\n  import { getFileAccessHttpUrl } from '@/api/manage'\r\n\r\n  const uidGenerator=()=>{\r\n    return '-'+parseInt(Math.random()*10000+1,10);\r\n  }\r\n  const getFileName=(path)=>{\r\n    if(path.lastIndexOf(\"\\\\\")>=0){\r\n      let reg=new RegExp(\"\\\\\\\\\",\"g\");\r\n      path = path.replace(reg,\"/\");\r\n    }\r\n    return path.substring(path.lastIndexOf(\"/\")+1);\r\n  }\r\n  export default {\r\n    name: 'JImageUpload',\r\n    data(){\r\n      return {\r\n        uploadAction:window._CONFIG['domianURL']+\"/sys/common/upload\",\r\n        uploadLoading:false,\r\n        picUrl:false,\r\n        headers:{},\r\n        fileList: [],\r\n        previewImage:\"\",\r\n        previewVisible: false,\r\n      }\r\n    },\r\n    props:{\r\n      text:{\r\n        type:String,\r\n        required:false,\r\n        default:\"上传\"\r\n      },\r\n      /*这个属性用于控制文件上传的业务路径*/\r\n      bizPath:{\r\n        type:String,\r\n        required:false,\r\n        default:\"temp\"\r\n      },\r\n      value:{\r\n        type:[String,Array],\r\n        required:false\r\n      },\r\n      disabled:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: false\r\n      },\r\n      isMultiple:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: false\r\n      },\r\n      //update-begin-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\r\n      number:{\r\n        type:Number,\r\n        required:false,\r\n        default:0\r\n      }\r\n      //update-end-author:wangshuai date:20201021 for:LOWCOD-969 新增number属性，用于判断上传数量\r\n    },\r\n    watch:{\r\n      value: {\r\n        handler(val,oldValue) {\r\n          if (val instanceof Array) {\r\n            this.initFileList(val.join(','))\r\n          } else {\r\n            this.initFileList(val)\r\n          }\r\n          if(!val || val.length==0){\r\n            this.picUrl = false;\r\n          }\r\n        },\r\n        //立刻执行handler\r\n        immediate: true\r\n      }\r\n    },\r\n    created(){\r\n      const token = Vue.ls.get(ACCESS_TOKEN);\r\n      this.headers = {\"X-Access-Token\":token}\r\n    },\r\n    methods:{\r\n      initFileList(paths){\r\n        if(!paths || paths.length==0){\r\n          this.fileList = [];\r\n          return;\r\n        }\r\n        this.picUrl = true;\r\n        let fileList = [];\r\n        let arr = paths.split(\",\")\r\n        for(var a=0;a<arr.length;a++){\r\n          let url = getFileAccessHttpUrl(arr[a]);\r\n          fileList.push({\r\n            uid: uidGenerator(),\r\n            name: getFileName(arr[a]),\r\n            status: 'done',\r\n            url: url,\r\n            response:{\r\n              status:\"history\",\r\n              message:arr[a]\r\n            }\r\n          })\r\n        }\r\n        this.fileList = fileList\r\n      },\r\n      beforeUpload: function(file){\r\n        var fileType = file.type;\r\n        if(fileType.indexOf('image')<0){\r\n          this.$message.warning('请上传图片');\r\n          return false;\r\n        }\r\n      },\r\n      handleChange(info) {\r\n        this.picUrl = false;\r\n        let fileList = info.fileList\r\n        //update-begin-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\r\n        if(this.number>0 && this.isMultiple){\r\n          fileList = fileList.slice(-this.number);\r\n        }\r\n        //update-end-author:wangshuai date:20201022 for:LOWCOD-969 判断number是否大于0和是否多选，返回选定的元素。\r\n        if(info.file.status==='done'){\r\n          if(info.file.response.success){\r\n            this.picUrl = true;\r\n            fileList = fileList.map((file) => {\r\n              if (file.response) {\r\n                file.url = file.response.message;\r\n              }\r\n              return file;\r\n            });\r\n          }\r\n          //this.$message.success(`${info.file.name} 上传成功!`);\r\n        }else if (info.file.status === 'error') {\r\n          this.$message.error(`${info.file.name} 上传失败.`);\r\n        }else if(info.file.status === 'removed'){\r\n          this.handleDelete(info.file)\r\n        }\r\n        this.fileList = fileList\r\n        if(info.file.status==='done' || info.file.status === 'removed'){\r\n          this.handlePathChange()\r\n        }\r\n      },\r\n      // 预览\r\n      handlePreview (file) {\r\n        this.previewImage = file.url || file.thumbUrl\r\n        this.previewVisible = true\r\n      },\r\n      getAvatarView(){\r\n        if(this.fileList.length>0){\r\n          let url = this.fileList[0].url\r\n          return getFileAccessHttpUrl(url)\r\n        }\r\n      },\r\n      handlePathChange(){\r\n        let uploadFiles = this.fileList\r\n        let path = ''\r\n        if(!uploadFiles || uploadFiles.length==0){\r\n          path = ''\r\n        }\r\n        let arr = [];\r\n        if(!this.isMultiple && uploadFiles.length>0){\r\n          arr.push(uploadFiles[uploadFiles.length-1].response.message)\r\n        }else{\r\n          for(let a=0;a<uploadFiles.length;a++){\r\n            // update-begin-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\r\n            if(uploadFiles[a].status === 'done' ) {\r\n              arr.push(uploadFiles[a].response.message)\r\n            }else{\r\n              return;\r\n            }\r\n            // update-end-author:taoyan date:20200819 for:【开源问题z】上传图片组件 LOWCOD-783\r\n          }\r\n        }\r\n        if(arr.length>0){\r\n          path = arr.join(\",\")\r\n        }\r\n        this.$emit('change', path);\r\n      },\r\n      handleDelete(file){\r\n        //如有需要新增 删除逻辑\r\n        console.log(file)\r\n      },\r\n      handleCancel() {\r\n        this.close();\r\n        this.previewVisible = false;\r\n      },\r\n      close () {\r\n\r\n      },\r\n    },\r\n    model: {\r\n      prop: 'value',\r\n      event: 'change'\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  /* update--begin--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白\r\n  * https://github.com/zhangdaiscott/jeecg-boot/issues/1810\r\n  * https://github.com/zhangdaiscott/jeecg-boot/issues/1779\r\n  */\r\n\r\n  /deep/ .imgupload .iconp{padding:20px;}\r\n  /* update--end--autor:lvdandan-----date:20201016------for：j-image-upload图片组件单张图片详情回显空白*/\r\n\r\n  /deep/ .image-upload-single-over .ant-upload-select{display: none}\r\n</style>\r\n"]}]}